<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="2Q Website Project">
    <meta name="keywords" content="2Q-Project, Website, Projects, Web Development">
    <meta name="authors" content="Isaiah Gael D. Bato, Russell Jayden M. Dayag">
    <title>Frisbee4Fun - Minigames</title>
    <link rel="icon" href="" sizes="32x32" type="image/jpg">
    <link rel="stylesheet" href="../CSS Files/headfoot.css">
    <link rel="stylesheet" href="../CSS Files/minigames.css">
</head>
<body>
<header>
    <div class="top">
        <div class="topimg">
            <img>
        </div>
        <div class="toptitle">
            Frisbee4Fun: Your Guide to Becoming An All Star
        </div>
    </div>
    <div class="nav">
        <ul>
            <li class="head"><a href="../public/pages/minigames.html">Minigames</a></li>
            <li class="head"><a href="../public/pages/stratsandforms.html">Strategies</a></li>
            <li class="head"><a href="../public/pages/ultimatefrisbee.html">Ultimate Frisbee</a></li>
            <li class="head"><a href="../public/pages/tipsntricks.html">Tips and Tricks</a></li>
            <li class="head"><a href="../public/pages/throws.html">Throws</a></li>
            <li class="head"><a href="../public/pages/intro.html">Intro</a></li>
        </ul>
    </div>
</header>

<div id="game-selection">
    <div class="game-box" data-popup="qa-popup">Q&A</div>
    <div class="game-box" data-popup="reaction-popup">Reaction Test</div>
    <div class="game-box" data-popup="loot-popup">Loot Box</div>
</div>

<div class="hover-overlay" id="overlay"></div>

<div class="hover-popup" id="qa-popup">
    <h2>Frisbee Q&A Preview</h2>
    <p>Test your knowledge about frisbee! Answer questions and see how well you know the sport.</p>
</div>

<div class="hover-popup" id="reaction-popup">
    <h2>Reaction Test Preview</h2>
    <p>Catch the flying frisbee as quickly as possible! You have 0.5 seconds after the screen turns green to click the frisbee to catch it!</p>
</div>

<div class="hover-popup" id="loot-popup">
  <h2>Loot Box Preview</h2>
  <p>Spin the loot box to get frisbee items of different rarity.</p>
    <button id="prob-btn">Show Probability Table</button>
    <div class="inner-overlay" id="prob-overlay"></div>
    <div id="prob-popup" class="inner-popup">
    <h3>Loot Box Probability Table</h3>
        <table>
            <tr><th>Rarity</th><th>Probability</th></tr>
            <tr class="common"><td>Common</td><td>40%</td></tr>
            <tr class="uncommon"><td>Uncommon</td><td>25%</td></tr>
            <tr class="rare"><td>Rare</td><td>15%</td></tr>
            <tr class="epic"><td>Epic</td><td>10%</td></tr>
            <tr class="legendary"><td>Legendary</td><td>7%</td></tr>
            <tr class="mythical"><td>Mythical</td><td>3%</td></tr>
        </table>
    <button id="close-prob">Close</button>
</div>


  <div id="loot-container">
    <div id="loot-carousel">
      <div class="loot-track">
        <div class="loot-item" data-rarity="common"><img src="../images/fabric-disc.png" alt="Fabric Disc"></div>
        <div class="loot-item" data-rarity="common"><img src="../images/vintage-boots.png" alt="Vintage Boots"></div>
        <div class="loot-item" data-rarity="common"><img src="../images/training-jersey.png" alt="Training Jersey"></div>
        <div class="loot-item" data-rarity="uncommon"><img src="../images/Kid-disc.png" alt="Kid Disc"></div>
        <div class="loot-item" data-rarity="uncommon"><img src="../images/Decathlon-boots.png" alt="Decathlon Boots"></div>
        <div class="loot-item" data-rarity="rare"><img src="../images/Disc-golf.png" alt="Disc Golf"></div>
        <div class="loot-item" data-rarity="rare"><img src="../images/nivia-boots.png" alt="Nivia Boots"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/Decathlon-disc.png" alt="Decathlon Disc"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/puma-boots.png" alt="Puma Boots"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/minions-jersey.png" alt="Minions Jersey"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/Competition-disc.png" alt="Competition Disc"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/adidas-boots.png" alt="Adidas Boots"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/alianti-jersey.png" alt="Alianti Jersey"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/USA-disc.png" alt="USA Disc"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/nike-boots.png" alt="Nike Boots"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/ph-jersey.png" alt="PH Jersey"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/usa-jersey.png" alt="USA Jersey"></div>

        <!-- repeat all items once more for smooth spin -->

        <div class="loot-item" data-rarity="common"><img src="../images/fabric-disc.png" alt="Fabric Disc"></div>
        <div class="loot-item" data-rarity="common"><img src="../images/vintage-boots.png" alt="Vintage Boots"></div>
        <div class="loot-item" data-rarity="common"><img src="../images/training-jersey.png" alt="Training Jersey"></div>
        <div class="loot-item" data-rarity="uncommon"><img src="../images/Kid-disc.png" alt="Kid Disc"></div>
        <div class="loot-item" data-rarity="uncommon"><img src="../images/Decathlon-boots.png" alt="Decathlon Boots"></div>
        <div class="loot-item" data-rarity="rare"><img src="../images/Disc-golf.png" alt="Disc Golf"></div>
        <div class="loot-item" data-rarity="rare"><img src="../images/nivia-boots.png" alt="Nivia Boots"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/Decathlon-disc.png" alt="Decathlon Disc"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/puma-boots.png" alt="Puma Boots"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/minions-jersey.png" alt="Minions Jersey"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/Competition-disc.png" alt="Competition Disc"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/adidas-boots.png" alt="Adidas Boots"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/alianti-jersey.png" alt="Alianti Jersey"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/USA-disc.png" alt="USA Disc"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/nike-boots.png" alt="Nike Boots"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/ph-jersey.png" alt="PH Jersey"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/usa-jersey.png" alt="USA Jersey"></div>

        <!-- repeat all items once more for smooth spin -->

        <div class="loot-item" data-rarity="common"><img src="../images/fabric-disc.png" alt="Fabric Disc"></div>
        <div class="loot-item" data-rarity="common"><img src="../images/vintage-boots.png" alt="Vintage Boots"></div>
        <div class="loot-item" data-rarity="common"><img src="../images/training-jersey.png" alt="Training Jersey"></div>
        <div class="loot-item" data-rarity="uncommon"><img src="../images/Kid-disc.png" alt="Kid Disc"></div>
        <div class="loot-item" data-rarity="uncommon"><img src="../images/Decathlon-boots.png" alt="Decathlon Boots"></div>
        <div class="loot-item" data-rarity="rare"><img src="../images/Disc-golf.png" alt="Disc Golf"></div>
        <div class="loot-item" data-rarity="rare"><img src="../images/nivia-boots.png" alt="Nivia Boots"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/Decathlon-disc.png" alt="Decathlon Disc"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/puma-boots.png" alt="Puma Boots"></div>
        <div class="loot-item" data-rarity="epic"><img src="../images/minions-jersey.png" alt="Minions Jersey"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/Competition-disc.png" alt="Competition Disc"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/adidas-boots.png" alt="Adidas Boots"></div>
        <div class="loot-item" data-rarity="legendary"><img src="../images/alianti-jersey.png" alt="Alianti Jersey"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/USA-disc.png" alt="USA Disc"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/nike-boots.png" alt="Nike Boots"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/ph-jersey.png" alt="PH Jersey"></div>
        <div class="loot-item" data-rarity="mythical"><img src="../images/usa-jersey.png" alt="USA Jersey"></div>
      </div>
    </div>
    <div id="loot-line"></div>
    <div id="loot-result"></div>
    <button id="loot-spin">Open Loot Box</button>
  </div>
</div>


<footer>
    <div class="footer">
        <div class="copyright">Copyright</div>
        <div class="ig"><a href="">Isaiah's Instagram</a><br><a href="">Russell's Instagram</a></div>
        <div class="fb"><a href="">Isaiah's Facebook</a><br><a href="">Russell's Facebook</a></div>
        <div class="frisbee"><a href="">Frisbee Site</a></div>
        <div class="email"><a href="">Isaiah's email</a><br><a href="">Russell's email</a></div>
        <div class="references"><a href="../pages/references.html">References</a></div>
    </div>
</footer>

<script>
const overlay = document.getElementById('overlay');
const spinBtn = document.getElementById("loot-spin");
const track = document.querySelector(".loot-track");
const carousel = document.getElementById("loot-carousel");
const result = document.getElementById("loot-result");
let scrollX = 0;
let idleAnim = null;
let isSpinning = false;

// idle infinite scroll animation
function startIdleScroll() {
    function idle() {
        if (!isSpinning) {
            scrollX -= 1;
            const width = track.scrollWidth / 2;
            if (Math.abs(scrollX) >= width) scrollX = 0;
            track.style.transform = `translateX(${scrollX}px)`;
        }
        idleAnim = requestAnimationFrame(idle);
    }
    if (!idleAnim) idle();
}

function startIdleScroll() {
    track.classList.add('idle');   // css animation
}

function stopIdleScroll() {
    track.classList.remove('idle'); // stop idle animation visually
}
const lootPopup = document.getElementById("loot-popup");

document.querySelectorAll('.game-box').forEach(box => {
    box.onclick = () => {
        const popup = document.getElementById(box.dataset.popup);
        popup.style.display = 'flex';
        overlay.style.display = 'block';

        if (popup.id === "loot-popup") {
            startIdleScroll();
        }
    }
});

overlay.onclick = () => {
    document.querySelectorAll('.hover-popup').forEach(popup => popup.style.display = 'none');
    overlay.style.display = 'none';

    // reset loot box spin state if closing while spinning
    isSpinning = false;
    spinBtn.disabled = false;

    // reset idle scroll 
    track.style.transition = "none";
    startIdleScroll();
};

spinBtn.addEventListener("click", () => {
    if (isSpinning) return;
    isSpinning = true;
    spinBtn.disabled = true;

    stopIdleScroll();

    const items = document.querySelectorAll(".loot-item");
    const itemWidth = items[0].offsetWidth + 24;
    const winIndex = Math.floor(Math.random() * items.length);
    const centerOffset = (carousel.offsetWidth / 2) - (itemWidth / 2);
    const finalX = -(winIndex * itemWidth) + centerOffset;

    // spin animation
    track.style.transition = "transform 3s cubic-bezier(0.15, 0.8, 0.2, 1)";
    track.style.transform = `translateX(${finalX}px)`;

    track.addEventListener('transitionend', function onTransitionEnd() {
        track.style.transition = "none"; 
        // restart idle scroll
        startIdleScroll();

        // show result after spin ends
        const winningItem = items[winIndex];
        const rarity = winningItem.dataset.rarity;
        const imgAlt = winningItem.querySelector('img').alt;
        result.textContent = `You won:  ${imgAlt} (${rarity})`;
        result.className = rarity;

        isSpinning = false;
        spinBtn.disabled = false;

        track.removeEventListener('transitionend', onTransitionEnd);
    });
});

const probBtn = document.getElementById("prob-btn");
const probPopup = document.getElementById("prob-popup");
const probOverlay = document.getElementById("prob-overlay");
const closeProb = document.getElementById("close-prob");

probBtn.addEventListener("click", () => {
    probPopup.classList.add("show");
    probOverlay.classList.add("show");
});

closeProb.addEventListener("click", () => {
    probPopup.classList.remove("show");
    probOverlay.classList.remove("show");
});

probOverlay.addEventListener("click", () => {
    probPopup.classList.remove("show");
    probOverlay.classList.remove("show");
});


</script>
</body>
</html>
